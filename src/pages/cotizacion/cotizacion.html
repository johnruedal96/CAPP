<!--
  Generated template for the CotizacionPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>

	<ion-navbar color="orange" *ngIf=!busqueda>

		<button ion-button menuToggle>
			<ion-icon name="menu"></ion-icon>
		</button>
		<div class="div_title">
			<img src="assets/icon_casco.png">
			<label>CAPP</label>
		</div>
		<ion-title>
			<div class="text-title">Cotización</div>
		</ion-title>

		<ion-buttons end *ngIf="tabsCotizacion == 'empresaTab'">
			<button ion-button icon-only (click)="inputSearch()">
				<ion-icon name="search"></ion-icon>
			</button>
		</ion-buttons>
	</ion-navbar>

	<ion-navbar calss="search-header" *ngIf=busqueda>

		<ion-searchbar #searchbar placeholder="buscar" (keypress)="search($event.keyCode)" [(ngModel)]="txtSearch" [showCancelButton]="true"
		 (ionCancel)="closeSearch($event)">
		</ion-searchbar>

	</ion-navbar>

</ion-header>


<ion-content>

	<div>
		<ion-segment [(ngModel)]="tabsCotizacion" color="darkCapp">
			<ion-segment-button value="productoTab">
				Productos
			</ion-segment-button>
			<ion-segment-button value="empresaTab">
				Empresas
			</ion-segment-button>
		</ion-segment>
	</div>
	<ion-input type="hidden" (ionChange)="getEmpresas()" value="{{storage.empresaId}}"></ion-input>
	<div [ngSwitch]="tabsCotizacion">
		<!--tab Productos-->
		<!--/////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
		<ion-list *ngSwitchCase="'productoTab'" padding>
			<button (click)="listarProductos()" ion-button style="margin: 0; width: 48%; font-size: 1.3rem">Agregar Producto</button>
			<button (click)="cancelarCotizacion()" ion-button style="margin-left: -5px; width: 48%; font-size: 1.3rem" color="warning">Cancelar Cotización</button>
			<h3 *ngIf="storage.productos.length > 0">Lista de compra</h3>
			<ion-row class="row-head row-table">
				<ion-col col-12 class="col-body">Producto</ion-col>
			</ion-row>
			<ion-row *ngIf="storage.productos.length == 0">
				<ion-col col-12 text-center>
					No se ha agregado ningun producto
				</ion-col>
			</ion-row>


			<ion-list>
				<ion-item class="item-table" *ngFor="let item of storage.productos">
					<ion-row class="row-table">
						<ion-col col-1 text-center class="btn-eliminar">
							<button ion-button clear>
									<ion-icon (click)="deleteItem(item)" name="close"></ion-icon>
								</button>
						</ion-col>
						<ion-col col-7 text-center>
							<label style="white-space: normal !important; font-size: 1.3rem !important">{{item.producto.nombre}}</label>
						</ion-col>
						<ion-col col-4>
							<ion-row>
								<ion-col col-2>
									<button (click)="changeCantidad(true, item)" ion-button class="btn-add-remove" color="danger"><ion-icon name="remove"></ion-icon></button>
								</ion-col>
								<ion-col col-7 text-center>
									<label style="white-space: normal !important; font-size: 1.3rem !important">{{item.cantidad}} </label>
									<ion-row>
										<ion-col col-12>
											<label style="white-space: normal !important; font-size: 1rem !important">{{item.unidad.nombre}}</label>
										</ion-col>
									</ion-row>
								</ion-col>
								<ion-col col-2>
									<button (click)="changeCantidad(false, item)" ion-button class="btn-add-remove"><ion-icon name="add"></ion-icon></button>
								</ion-col>
							</ion-row>
						</ion-col>
					</ion-row>
				</ion-item>
			</ion-list>

			<button *ngIf="storage.productos.length > 0" color="success" [disabled]="disabledButtonEnviar" ion-button full (click)="alertCotizacion()">Enviar Cotización</button>

		</ion-list>
		<!--/////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->

		<!--Tab Empresas-->
		<!--/////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
		<ion-list *ngSwitchCase="'empresaTab'">
			<ion-list>
				<ion-item>
					<ion-label>Filtro</ion-label>
					<ion-select interface="popover" [(ngModel)]="filtro" (ionChange)="aplicarFiltro()">
						<ion-option selected="true" value="1">Todas</ion-option>
						<ion-option value="2">Seleccionadas</ion-option>
					</ion-select>
				</ion-item>
			</ion-list>

			<ion-list class="lista">
				<div class="spinnerCargando" *ngIf="showSpinnerEmpresas">
					<!-- <div class="spinnerCargando"> -->
					<ion-spinner class="spinnerCargando" name="crescent"></ion-spinner>
					<p text-center>Cargando...</p>
				</div>
				<ion-row *ngFor="let empresa of empresasLoad">
					<ion-col col-12 class="items empresas-items" (click)="selectEmpresa(empresa)">
						<ion-item [color]="empresa.selected ? 'success' : 'white'">
							<ion-avatar item-start class="avatar">
								<img class="img-logo" src="{{imagen}}{{empresa.imagen}}">
							</ion-avatar>
							<h3>{{empresa.nombre}}</h3>
							<p class="circle-estado"></p>
						</ion-item>
					</ion-col>
				</ion-row>
			</ion-list>

			<ion-infinite-scroll (ionInfinite)="doInfinite($event)" *ngIf="enabledInfinite">
				<ion-infinite-scroll-content loadingSpinner="crescent" loadingText="Cargando mas datos...">
				</ion-infinite-scroll-content>
			</ion-infinite-scroll>

		</ion-list>
		<!--/////////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
	</div>
</ion-content>